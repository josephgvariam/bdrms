!function(){var o,i,e,s,t=(o=new Audio("data:audio/mpeg;base64,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wZ0G7jqlt/OcDIKX+/1NblSX+VKfQfP8xuJJGk7////rf////+PgXTv///1JThJJQainmySAB6imUyuVbVttUo7T4Csa821OuF88f62+CZHFnGf///mQgYIEO0SMF2NVy9NxYTdlqJ8AuS4zr//SJoTUJ+CaKKTcZvosrUPo8W/MUv0f033E9E/QpN6P///v/////WRR2mwUAYUABjabRu1vrOLKAF0kIdHjnEx/iNWo7jGn1////mApxNTJQQOU1Het/NoUFTMQs6Vja///THaGIl/0fojl8mjd/Jo8W+ZfpNpCajsz7////6kn/////WRRgDz//LD1KSTDjKOciSAKxdLx5S31uYqKIWj/+5JECgAC8V5M6g9rdFyr6Vo9rW6KtHcr5DEJQRkSpLRklSigvVc4QpmyPe9H3zHR1/in9P/8VNCMJOzYUDyVjfwHP0ZgiZt/3/+9EBnDKbegdUrckhgntHaQ9vX/X/9A/////+r/////mJ3/9ItRcoVRogAcmV9N8z0pvES8QQsKoMGXEymPQyWm6E4HQLqgpv/CZJAtYXQSwoF8e6SB56zABEoW+qgZjJAZovGr0Gl5/OjFKL3JwnaX9v7/X8y1f/////////49WAzMzEYYMZLq6CUANIqbDX7lisBIdraAEPwShTRc9WZ2vAqBc4NQ9GrUNaw0Czcrte0g1NEoiU8NFjx4NFh54FSwlOlgaCp0S3hqo8SLOh3/63f7P/KgKJxxhgGSnAFMCnIogwU5JoqBIDAuBIiNLETyFmiImtYiDTSlb8ziIFYSFv/QPC38zyxEOuPeVGHQ77r/1u/+kq49//6g4gjoVQSUMYQUSAP8PwRcZIyh2kCI2OwkZICZmaZxgnsNY8DmSCWX0idhtz3VTJSqErTSB//1X7TTTVVV//uSZB2P8xwRJ4HvYcItQlWBACM4AAABpAAAACAAADSAAAAEVf/+qCE000VVVVU0002//+qqqqummmmr///qqqppppoqqqqppppoqqATkEjIyIxBlBA5KwUEDBBwkFhYWFhUVFfiqhYWFhcVFRUVFv/Ff/xUVFRYWFpMQU1FMy45OS41qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqg=="),i={inputStream:{type:"LiveStream",constraints:{width:640,height:480,facingMode:"environment"}},locator:{patchSize:"medium",halfSample:!0},numOfWorkers:navigator.hardwareConcurrency?navigator.hardwareConcurrency:4,decoder:{readers:["code_128_reader"],multiple:!1},locate:!0},{init:function(t){$("#livestream_scanner").on("shown.bs.modal",function(e){Quagga.init(i,function(e){if(e)return $("#livestream_scanner .modal-body .error").html('<div class="alert alert-danger"><strong><i class="fa fa-exclamation-triangle"></i> '+e.name+"</strong>: "+e.message+"</div>"),void Quagga.stop();Quagga.start()})}),Quagga.onProcessed(function(t){var o=Quagga.canvas.ctx.overlay,e=Quagga.canvas.dom.overlay;t&&(t.boxes&&(o.clearRect(0,0,parseInt(e.getAttribute("width")),parseInt(e.getAttribute("height"))),t.boxes.filter(function(e){return e!==t.box}).forEach(function(e){Quagga.ImageDebug.drawPath(e,{x:0,y:1},o,{color:"green",lineWidth:2})})),t.box&&Quagga.ImageDebug.drawPath(t.box,{x:0,y:1},o,{color:"#00F",lineWidth:2}),t.codeResult&&t.codeResult.code&&Quagga.ImageDebug.drawPath(t.line,{x:"x",y:"y"},o,{color:"red",lineWidth:3}))}),Quagga.onDetected(function(e){console.log(e),e.codeResult.code&&(o.play(),Quagga.stop(),setTimeout(function(){$("#livestream_scanner").modal("hide"),$(t).val(e.codeResult.code).trigger("change")},500))}),$("#livestream_scanner").on("hide.bs.modal",function(){Quagga&&Quagga.stop()})}}),n={showInfoModal:function(e,t,o){var i=$("#infoModal");i.find(".modal-title").text(e),i.find(".modal-body").html("<p>"+t+"</p>"),o&&i.on("hidden.bs.modal",o),i.modal()},showAlert:function(e,t,o){var i='<div id="workflowAlert" class="alert alert-'+o+' alert-dismissible col-md-10 col-md-offset-1"><strong><button type="button" class="close" data-dismiss="alert" ><span>&times;</span></button>'+e+"</strong> "+t+"</div>";$("#alert").html(i)},getBoxes:function(e,t){var c;if(0===(c=t?r.fetchRecords(e):new g).size()){var o=e.get("inventoryItems"),d=e.get("storageType").name;_.each(o,function(e){var t=new h({id:e.id,ref1:e.ref1,ref2:e.ref2,ref3:e.ref3,ref4:e.ref4,ref5:e.ref5,type:e.type,status:e.status});if("BOX"===e.type){var o=new u({id:e.box.id,barcode:e.box.barcode,location:e.box.location,inventoryItem:t});o.storageType=d,c.add(o)}else if("FILE"===e.type){var i=new f({id:e.file.id,barcode:e.file.barcode,location:e.file.location,inventoryItem:t});i.storageType=d;var s=c.findWhere({barcode:e.file.box.barcode});s||((s=new u({id:e.file.box.id,barcode:e.file.box.barcode,location:e.file.box.location,files:new m})).storageType=d,c.add(s)),s.get("files").add(i)}else if("DOCUMENT"===e.type){var n=new A({id:e.document.id,barcode:e.document.barcode,location:e.document.location,inventoryItem:t});n.storageType=d;var r=c.findWhere({barcode:e.document.file.box.barcode});r||((r=new u({id:e.document.file.box.id,barcode:e.document.file.box.barcode,location:e.document.file.box.location,files:new m})).storageType=d,c.add(r));var a=r.get("files").findWhere({barcode:e.document.file.barcode});a||((a=new f({id:e.document.file.id,barcode:e.document.file.barcode,location:e.document.file.location,documents:new q})).storageType=d,r.get("files").add(a)),a.get("documents").add(n)}})}return c}},r=(e=Backbone.Model.extend(),s=new(Backbone.Collection.extend({model:e,localStorage:new Backbone.LocalStorage("in.bigdash.rms.app.storage")})),{storeBox:function(e,t){var o=new u({id:e.get("barcode"),location:e.get("location"),requestId:t.get("id"),storageType:t.get("storageType").name,type:"BOX"});"BOX"===t.get("storageType").name&&o.set({ref1:e.get("inventoryItem").get("ref1"),ref2:e.get("inventoryItem").get("ref2"),ref3:e.get("inventoryItem").get("ref3"),ref4:e.get("inventoryItem").get("ref4"),ref5:e.get("inventoryItem").get("ref5"),type:e.get("inventoryItem").get("type"),status:e.get("inventoryItem").get("status")}),(o=s.add(o,{merge:!0})).save()},storeFile:function(e,t,o){var i=new f({id:e.get("barcode"),location:e.get("location"),parentId:t.get("barcode"),requestId:o.get("id"),storageType:o.get("storageType").name,type:"FILE"});"FILE"===o.get("storageType").name&&i.set({ref1:e.get("inventoryItem").get("ref1"),ref2:e.get("inventoryItem").get("ref2"),ref3:e.get("inventoryItem").get("ref3"),ref4:e.get("inventoryItem").get("ref4"),ref5:e.get("inventoryItem").get("ref5"),type:e.get("inventoryItem").get("type"),status:e.get("inventoryItem").get("status")}),(i=s.add(i,{merge:!0})).save()},storeDocument:function(e,t,o){var i=new A({id:e.get("barcode"),location:e.get("location"),parentId:t.get("barcode"),requestId:o.get("id"),storageType:o.get("storageType").name,type:"DOCUMENT"});"DOCUMENT"===o.get("storageType").name&&i.set({ref1:e.get("inventoryItem").get("ref1"),ref2:e.get("inventoryItem").get("ref2"),ref3:e.get("inventoryItem").get("ref3"),ref4:e.get("inventoryItem").get("ref4"),ref5:e.get("inventoryItem").get("ref5"),type:e.get("inventoryItem").get("type"),status:e.get("inventoryItem").get("status")}),(i=s.add(i,{merge:!0})).save()},remove:function(e){s.get(e.get("barcode")).destroy()},fetchRecords:function(e){s.fetch();var t=s.where({requestId:e.get("id")}),c=new g,d=new m,l=new q;return _.each(t,function(e){var t=e.get("type");if("BOX"===t){var o=new u({barcode:e.get("id"),location:e.get("location")});if(o.storageType=e.get("storageType"),"BOX"===o.storageType){var i=new h({ref1:e.get("ref1"),ref2:e.get("ref2"),ref3:e.get("ref3"),ref4:e.get("ref4"),ref5:e.get("ref5"),type:e.get("type"),status:e.get("status")});o.set("inventoryItem",i)}else o.set("files",new m);c.add(o)}else if("FILE"===t){var s=new f({barcode:e.get("id"),location:e.get("location")});if(s.storageType=e.get("storageType"),s.parentBarcode=e.get("parentId"),"FILE"===s.storageType){var n=new h({ref1:e.get("ref1"),ref2:e.get("ref2"),ref3:e.get("ref3"),ref4:e.get("ref4"),ref5:e.get("ref5"),type:e.get("type"),status:e.get("status")});s.set("inventoryItem",n)}else s.set("documents",new q);d.add(s)}else if("DOCUMENT"===t){var r=new A({barcode:e.get("id"),location:e.get("location")});r.storageType=e.get("storageType"),r.parentBarcode=e.get("parentId");var a=new h({ref1:e.get("ref1"),ref2:e.get("ref2"),ref3:e.get("ref3"),ref4:e.get("ref4"),ref5:e.get("ref5"),type:e.get("type"),status:e.get("status")});r.set("inventoryItem",a),l.add(r)}}),l.each(function(e){d.findWhere({barcode:e.parentBarcode}).get("documents").add(e)}),d.each(function(e){c.findWhere({barcode:e.parentBarcode}).get("files").add(e)}),c},clearRecords:function(e){var t=s.where({requestId:e.get("id")});_.each(t,function(e){e.destroy()})}}),a=Backbone.Model.extend({urlRoot:function(){return this.get("type")?"/api/"+this.get("type").toLowerCase()+"requests":"/api/requests"},initialize:function(){this.listenTo(this,"request",this.requestStart),this.listenTo(this,"sync",this.requestSuccess),this.listenTo(this,"error",this.requestError),this.spinner=new Spinner},startSpinner:function(){this.spinner.spin(document.getElementById("loading"))},stopSpinner:function(e){this.spinner.stop()},requestStart:function(e,t,o){this.startSpinner()},requestSuccess:function(e,t,o){this.stopSpinner()},requestError:function(e,t,o){this.stopSpinner()}}),h=Backbone.Model.extend({defaults:{ref1:"",ref2:"",ref3:"",ref4:"",ref5:"",status:"NOTSTORED",type:null}}),c=Backbone.Collection.extend({model:h}),u=Backbone.Model.extend({defaults:{barcode:"",location:""}}),f=Backbone.Model.extend({defaults:{barcode:"",location:""}}),A=Backbone.Model.extend({defaults:{barcode:"",location:""}}),g=Backbone.Collection.extend({model:u}),m=Backbone.Collection.extend({model:f}),q=Backbone.Collection.extend({model:A}),d=Backbone.Model.extend({defaults:{verified:!1}}),l=Backbone.Collection.extend({model:d}),p=Marionette.View.extend({tagName:"tr",template:"#box-row-template",templateContext:function(){return{storageType:this.model.storageType}}}),w=Mn.View.extend({template:_.template("No Boxes. Start adding boxes.")}),v=Marionette.CollectionView.extend({tagName:"tbody",childView:p,emptyView:w}),x=Marionette.View.extend({template:"#boxes-template",regions:{body:{el:"tbody",replaceElement:!0}},initialize:function(){_.bindAll(this,"handleRecordsSaveSuccess","handleRecordsSaveError","doSaveRecords")},events:{"click #addBoxButton":"addBox","click #deleteBoxButton":"deleteBox","click div.ckbox>input":"updateDeleteButtonEnabled","click #editBoxButton":"editBox","click #showFilesButton":"showFiles","click #saveRecordsButton":"saveRecords","change #boxBarcode":"boxBarcodeChanged","blur #boxBarcode":"focusBack","click #cameraButton":"getBarcode"},getBarcode:function(e){e.preventDefault(),t.init("#boxBarcode"),$("#livestream_scanner").modal("show")},focusBack:function(){this.$("#boxBarcode").val(""),this.$("#boxBarcode").focus()},boxBarcodeChanged:function(e){var t=this.$("#boxBarcode").val().toUpperCase().trim();this.$("#boxBarcode").val(""),this.$("#boxBarcode").focus();var o=this.collection.findWhere({barcode:t}),i=this.options.request.get("storageType").name,s=void 0===o;s&&("BOX"===((o=new u({barcode:t})).storageType=i)?o.set("inventoryItem",new h({type:"BOX"})):o.set("files",new m)),"BOX"===i?this.triggerMethod("show:box",o):s&&(this.collection.add(o),r.storeBox(o,this.options.request))},validateRecords:function(){var e=this.options.request.get("storageType").name,o=[];return 0===this.collection.size()&&o.push("No boxes to save"),"BOX"===e||("FILE"===e?this.collection.each(function(e){0===e.get("files").size()&&o.push("Box "+e.get("barcode")+" does not have any files")}):"DOCUMENT"===e&&this.collection.each(function(t){0===t.get("files").size()?o.push("Box "+t.get("barcode")+" does not have any files"):t.get("files").each(function(e){0===e.get("documents").size()&&o.push("Box "+t.get("barcode")+", File "+e.get("barcode")+" does not have any documents")})})),o.length&&(swal.close(),this.showAlert(o,"warning")),0===o.length},showAlert:function(e,t){var o="";1===e.length?o=e[0]:(o="Please check the following: ",_.each(e,function(e){o=o+"<li>"+e+"</li>"})),n.showAlert("Error saving records!",o,t)},saveRecords:function(e){e.preventDefault(),$("#alert").html(""),this.validateRecords()&&swal({title:"Are you sure?",text:"You will not be able to modify records after saving!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"Yes, Save it!",closeOnConfirm:!1,showLoaderOnConfirm:!0},this.doSaveRecords)},doSaveRecords:function(){var a=new c;this.collection.each(function(r){if(r.get("inventoryItem")){var e=r.clone();e.unset("inventoryItem");var t=r.get("inventoryItem").clone();t.set("box",e),a.add(t)}else r.get("files").each(function(n){if(n.get("inventoryItem")){var e=n.clone(),t=r.clone();e.unset("inventoryItem"),t.unset("files"),e.set("box",t);var o=n.get("inventoryItem").clone();o.set("file",e),a.add(o)}else n.get("documents").each(function(e){var t=e.clone(),o=n.clone(),i=r.clone();t.unset("inventoryItem"),o.unset("documents"),i.unset("files"),o.set("box",i),t.set("file",o);var s=e.get("inventoryItem").clone();s.set("document",t),a.add(s)})})}),this.options.request.save({inventoryItems:a,status:"PACKED"},{wait:!0,success:this.handleRecordsSaveSuccess,error:this.handleRecordsSaveError})},handleRecordsSaveSuccess:function(e,t,o){r.clearRecords(this.options.request),swal({title:"Request Updated!",text:"Records have been saved.",type:"success"},function(){window.location.href="/requests/"+t.id+"/workflow"})},handleRecordsSaveError:function(e,t,o){t.responseJSON.message&&(swal.close(),this.showAlert([t.responseJSON.message],"danger"))},updateDeleteButtonEnabled:function(){$("div.ckbox>input:checked").length?$("#deleteBoxButton").prop("disabled",!1):$("#deleteBoxButton").prop("disabled",!0)},showFiles:function(e){e.preventDefault();var t=String($(e.currentTarget).data("barcode")),o=this.collection.findWhere({barcode:t});this.triggerMethod("show:files",o)},editBox:function(e){e.preventDefault();var t=String($(e.currentTarget).data("barcode")),o=this.collection.findWhere({barcode:t});this.triggerMethod("show:box",o)},addBox:function(e){e.preventDefault();var t=this.options.request.get("storageType").name,o=new u;"BOX"===(o.storageType=t)?o.set("inventoryItem",new h({type:"BOX"})):o.set("files",new m),this.triggerMethod("show:box",o)},deleteBox:function(e){var t=$("div.ckbox>input:checked"),i=[];_.each(t,function(e){var t=String($(e).data("barcode")),o=this.collection.findWhere({barcode:t});o.get("files")&&o.get("files").size()?i.push(o.get("barcode")):(this.collection.remove(o),r.remove(o))},this),0<i.length&&n.showAlert("","Cannot delete non empty records! Skipped boxes: "+i.join(", "),"warning"),this.updateDeleteButtonEnabled()},onRender:function(){this.showChildView("body",new v({collection:this.collection}))},onAttach:function(){navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.getUserMedia||this.$("#cameraButton").css("visibility","hidden"),this.$("#boxBarcode").focus()}}),b=Marionette.View.extend({template:"#box-template",templateContext:function(){return{storageType:this.model.storageType}},initialize:function(){this.isNewBox=""===this.model.get("barcode")},events:{"click #ok-button":"handleOkButton","click #cancel-button":"handleCancelButton"},validate:function(){this.clearValidationErrors();var e=!0,t=this.$("#barcode").val().trim().toUpperCase(),o=(this.$("#location").val().trim(),this.$("#ref1").val());return t||(this.showValidationError("barcode","may not be empty"),e=!1),"BOX"!==this.options.request.get("storageType").name||o||(this.showValidationError("ref1","may not be empty"),e=!1),e},handleOkButton:function(e){if(e.preventDefault(),this.validate()){var t=this.$("#barcode").val().trim().toUpperCase(),o=this.$("#location").val().trim();if(this.isNewBox&&this.options.boxes.findWhere({barcode:t}))this.showValidationError("barcode","barcode already exists");else{if(this.model.set({barcode:t,location:o}),"BOX"===this.options.request.get("storageType").name){var i=this.model.get("inventoryItem");i.set("ref1",this.$("#ref1").val().trim()),i.set("ref2",this.$("#ref2").val().trim()),i.set("ref3",this.$("#ref3").val().trim()),i.set("ref4",this.$("#ref4").val().trim()),i.set("ref5",this.$("#ref5").val().trim()),this.model.set("inventoryItem",i)}this.showBoxesView()}}},handleCancelButton:function(e){e.preventDefault(),this.model=null,this.showBoxesView()},showBoxesView:function(){this.triggerMethod("show:boxes",this.model,this.isNewBox)},clearValidationErrors:function(){this.$(".form-group").removeClass("has-error has-feedback"),this.$(".help-block").remove()},showValidationError:function(e,t){var o=this.$("#"+e);o.closest(".form-group").addClass("has-error has-feedback"),o.closest("div").append($('<span id="'+e+'-error" class="help-block">'+t+"</span>"))},onAttach:function(){this.isNewBox?this.$("#barcode").focus():(this.$("#barcode").prop("readonly",!0),this.$("#ref1").focus())}}),B=Marionette.View.extend({tagName:"tr",template:"#file-row-template",templateContext:function(){return{storageType:this.model.storageType}}}),y=Mn.View.extend({template:_.template("No Files. Start adding files.")}),S=Marionette.CollectionView.extend({tagName:"tbody",childView:B,emptyView:y}),V=Marionette.View.extend({template:"#files-template",regions:{body:{el:"tbody",replaceElement:!0}},initialize:function(){},events:{"click #addFileButton":"addFile","click #deleteFileButton":"deleteFile","click div.ckbox>input":"updateDeleteButtonEnabled","click #editFileButton":"editFile","click #showDocsButton":"showDocs","click #showBoxesButton":"showBoxes","change #fileBarcode":"fileBarcodeChanged","blur #fileBarcode":"focusBack"},focusBack:function(){this.$("#fileBarcode").val(""),this.$("#fileBarcode").focus()},fileBarcodeChanged:function(e){var t=this.$("#fileBarcode").val().toUpperCase().trim();this.$("#fileBarcode").val(""),this.$("#fileBarcode").focus();var o=this.collection.findWhere({barcode:t}),i=this.options.request.get("storageType").name,s=void 0===o;s&&("FILE"===((o=new f({barcode:t})).storageType=i)?o.set("inventoryItem",new h({type:"FILE"})):o.set("documents",new q)),"FILE"===i?this.triggerMethod("show:file",o,this.options.box):s&&(this.collection.add(o),r.storeFile(o,this.options.box,this.options.request))},showBoxes:function(e){this.triggerMethod("show:boxes")},updateDeleteButtonEnabled:function(){$("div.ckbox>input:checked").length?$("#deleteFileButton").prop("disabled",!1):$("#deleteFileButton").prop("disabled",!0)},showDocs:function(e){e.preventDefault();var t=String($(e.currentTarget).data("barcode")),o=this.collection.findWhere({barcode:t});this.triggerMethod("show:documents",o,this.options.box)},editFile:function(e){e.preventDefault();var t=String($(e.currentTarget).data("barcode")),o=this.collection.findWhere({barcode:t});this.triggerMethod("show:file",o,this.options.box)},addFile:function(e){var t=this.options.request.get("storageType").name,o=new f;"FILE"===(o.storageType=t)?o.set("inventoryItem",new h({type:"FILE"})):o.set("documents",new q),this.triggerMethod("show:file",o,this.options.box)},deleteFile:function(e){var t=$("div.ckbox>input:checked"),i=[];_.each(t,function(e){var t=String($(e).data("barcode")),o=this.collection.findWhere({barcode:t});o.get("documents")&&o.get("documents").size()?i.push(o.get("barcode")):(this.collection.remove(o),r.remove(o))},this),0<i.length&&n.showAlert("","Cannot delete non empty records! Skipped files: "+i.join(", "),"warning"),this.updateDeleteButtonEnabled()},onRender:function(){this.$("#filesPanelTitle").text("BOX "+this.options.box.get("barcode")+" >> FILES"),this.showChildView("body",new S({collection:this.collection}))},onAttach:function(){this.$("#fileBarcode").focus()}}),E=Marionette.View.extend({template:"#file-template",templateContext:function(){return{storageType:this.model.storageType}},initialize:function(){this.isNewFile=""===this.model.get("barcode")},events:{"click #ok-button":"handleOkButton","click #cancel-button":"handleCancelButton"},validate:function(){this.clearValidationErrors();var e=!0,t=this.$("#barcode").val().trim().toUpperCase(),o=(this.$("#location").val().trim(),this.$("#ref1").val());return t||(this.showValidationError("barcode","may not be empty"),e=!1),"FILE"!==this.options.request.get("storageType").name||o||(this.showValidationError("ref1","may not be empty"),e=!1),e},handleOkButton:function(e){if(e.preventDefault(),this.validate()){var t=this.$("#barcode").val().trim().toUpperCase(),o=this.$("#location").val().trim();if(this.isNewFile&&this.options.box.get("files").findWhere({barcode:t}))this.showValidationError("barcode","barcode already exists");else{if(this.model.set({barcode:t,location:o}),"FILE"===this.options.request.get("storageType").name){var i=this.model.get("inventoryItem");i.set("ref1",this.$("#ref1").val().trim()),i.set("ref2",this.$("#ref2").val().trim()),i.set("ref3",this.$("#ref3").val().trim()),i.set("ref4",this.$("#ref4").val().trim()),i.set("ref5",this.$("#ref5").val().trim()),this.model.set("inventoryItem",i)}this.options.box.get("files").add(this.model,{merge:!this.isNewFile}),r.storeFile(this.model,this.options.box,this.options.request),this.triggerMethod("show:files",this.options.box)}}},handleCancelButton:function(e){e.preventDefault(),this.model=null,this.triggerMethod("show:files",this.options.box)},clearValidationErrors:function(){this.$(".form-group").removeClass("has-error has-feedback"),this.$(".help-block").remove()},showValidationError:function(e,t){var o=this.$("#"+e);o.closest(".form-group").addClass("has-error has-feedback"),o.closest("div").append($('<span id="'+e+'-error" class="help-block">'+t+"</span>"))},onAttach:function(){var e=this.options.box.get("barcode"),t=this.isNewFile?"NEW FILE":"FILE "+this.model.get("barcode");this.$("#filePanelTitle").text("BOX "+e+" >> "+t),this.isNewFile?this.$("#barcode").focus():(this.$("#barcode").prop("readonly",!0),this.$("#ref1").focus())}}),C=Marionette.View.extend({tagName:"tr",template:"#document-row-template",templateContext:function(){return{storageType:this.model.storageType}}}),I=Mn.View.extend({template:_.template("No Documents. Start adding documents.")}),k=Marionette.CollectionView.extend({tagName:"tbody",childView:C,emptyView:I}),T=Marionette.View.extend({template:"#documents-template",regions:{body:{el:"tbody",replaceElement:!0}},initialize:function(){},events:{"click #addDocumentButton":"addDocument","click #deleteDocumentButton":"deleteDocument","click div.ckbox>input":"updateDeleteButtonEnabled","click #editDocumentButton":"editDocument","click #showFilesButton":"showFiles","change #docBarcode":"docBarcodeChanged","blur #docBarcode":"focusBack"},focusBack:function(){this.$("#docBarcode").val(""),this.$("#docBarcode").focus()},docBarcodeChanged:function(e){var t=this.$("#docBarcode").val().toUpperCase().trim();this.$("#docBarcode").val(""),this.$("#docBarcode").focus();var o=this.collection.findWhere({barcode:t}),i=this.options.request.get("storageType").name,s=void 0===o;s&&"DOCUMENT"===((o=new A({barcode:t})).storageType=i)&&o.set("inventoryItem",new h({type:"DOCUMENT"})),"DOCUMENT"===i?this.triggerMethod("show:document",o,this.options.file,this.options.box):s&&(this.collection.add(o),r.storeDocument(o,this.options.file,this.options.request))},showFiles:function(e){this.triggerMethod("show:files",this.options.box)},updateDeleteButtonEnabled:function(){$("div.ckbox>input:checked").length?$("#deleteDocumentButton").prop("disabled",!1):$("#deleteDocumentButton").prop("disabled",!0)},editDocument:function(e){e.preventDefault();var t=String($(e.currentTarget).data("barcode")),o=this.collection.findWhere({barcode:t});this.triggerMethod("show:document",o,this.options.file,this.options.box)},addDocument:function(e){var t=this.options.request.get("storageType").name,o=new A;"DOCUMENT"===(o.storageType=t)&&o.set("inventoryItem",new h({type:"DOCUMENT"})),this.triggerMethod("show:document",o,this.options.file,this.options.box)},deleteDocument:function(e){var t=$("div.ckbox>input:checked");_.each(t,function(e){var t=String($(e).data("barcode")),o=this.collection.findWhere({barcode:t});this.collection.remove(o),r.remove(o)},this),this.updateDeleteButtonEnabled()},onRender:function(){var e=this.options.box.get("barcode"),t=this.options.file.get("barcode");this.$("#documentsPanelTitle").text("BOX "+e+" >> FILE "+t+" >> DOCUMENTS"),this.showChildView("body",new k({collection:this.collection}))},onAttach:function(){this.$("#docBarcode").focus()}}),D=Marionette.View.extend({template:"#document-template",templateContext:function(){return{storageType:this.model.storageType}},initialize:function(){this.isNewDocument=""===this.model.get("barcode")},events:{"click #ok-button":"handleOkButton","click #cancel-button":"handleCancelButton"},validate:function(){this.clearValidationErrors();var e=!0,t=this.$("#barcode").val().trim().toUpperCase(),o=(this.$("#location").val().trim(),this.$("#ref1").val());return t||(this.showValidationError("barcode","may not be empty"),e=!1),"DOCUMENT"!==this.options.request.get("storageType").name||o||(this.showValidationError("ref1","may not be empty"),e=!1),e},handleOkButton:function(e){if(e.preventDefault(),this.validate()){var t=this.$("#barcode").val().trim().toUpperCase(),o=this.$("#location").val().trim();if(this.isNewDocument&&this.options.file.get("documents").findWhere({barcode:t}))this.showValidationError("barcode","barcode already exists");else{if(this.model.set({barcode:t,location:o}),"DOCUMENT"===this.options.request.get("storageType").name){var i=this.model.get("inventoryItem");i.set("ref1",this.$("#ref1").val().trim()),i.set("ref2",this.$("#ref2").val().trim()),i.set("ref3",this.$("#ref3").val().trim()),i.set("ref4",this.$("#ref4").val().trim()),i.set("ref5",this.$("#ref5").val().trim()),this.model.set("inventoryItem",i)}this.options.file.get("documents").add(this.model,{merge:!this.isNewDocument}),r.storeDocument(this.model,this.options.file,this.options.request),this.triggerMethod("show:documents",this.options.file,this.options.box)}}},handleCancelButton:function(e){e.preventDefault(),this.model=null,this.triggerMethod("show:documents",this.options.file,this.options.box)},clearValidationErrors:function(){this.$(".form-group").removeClass("has-error has-feedback"),this.$(".help-block").remove()},showValidationError:function(e,t){var o=this.$("#"+e);o.closest(".form-group").addClass("has-error has-feedback"),o.closest("div").append($('<span id="'+e+'-error" class="help-block">'+t+"</span>"))},onAttach:function(){var e=this.options.box.get("barcode"),t=this.options.file.get("barcode"),o=this.isNewDocument?"NEW DOCUMENT":"DOCUMENT "+this.model.get("barcode");this.$("#documentPanelTitle").text("BOX "+e+" >> FILE "+t+" >>  "+o),this.isNewDocument?this.$("#barcode").focus():(this.$("#barcode").prop("readonly",!0),this.$("#ref1").focus())}}),M=Marionette.View.extend({template:"#add-records-template",regions:{body:{el:"#add-records",replaceElement:!0}},initialize:function(){this.boxes=n.getBoxes(this.model,!0)},onRender:function(){this.showBoxesView()},onChildviewShowBox:function(e){this.showChildView("body",new b({model:e,boxes:this.boxes,request:this.model}))},onChildviewShowBoxes:function(e,t){e&&(this.boxes.add(e,{merge:!t}),r.storeBox(e,this.model)),this.showBoxesView()},showBoxesView:function(){this.showChildView("body",new x({collection:this.boxes,request:this.model,rootView:this.options.rootView}))},onChildviewShowFile:function(e,t){this.showChildView("body",new E({model:e,box:t,request:this.model}))},onChildviewShowFiles:function(e){this.showChildView("body",new V({collection:e.get("files"),box:e,request:this.model}))},onChildviewShowDocument:function(e,t,o){this.showChildView("body",new D({model:e,file:t,box:o,request:this.model}))},onChildviewShowDocuments:function(e,t){this.showChildView("body",new T({collection:e.get("documents"),file:e,box:t,request:this.model}))}}),R=Marionette.View.extend({template:"#assign-user-template",initialize:function(){_.bindAll(this,"handleSaveSuccess","handleSaveError")},events:{"click #save-button":"handleSave"},onRender:function(){this.$(".dropdown-select-ajax").select2({debug:!1,theme:"bootstrap",allowClear:!0})},handleSave:function(e){e.preventDefault(),this.$("#userAssigned").val()?this.model.save({userAssigned:{id:this.$("#userAssigned").val().trim()},status:"ASSIGNED"},{wait:!0,success:this.handleSaveSuccess,error:this.handleSaveError}):this.showValidationError("userAssigned","may not be null")},handleSaveSuccess:function(e,t){swal({title:"Request Updated!",text:"User has been assigned successfully.",type:"success"},function(){window.location.href="/requests/"+t.id})},handleSaveError:function(e,t){console.log(e,t),t.responseJSON&&_.each(t.responseJSON.errors,function(e,t){this.showValidationError(t,e)})},clearValidationErrors:function(){this.$(".form-group").removeClass("has-error has-feedback"),this.$(".help-block").remove()},showValidationError:function(e,t){var o=this.$("#"+e);o.closest(".form-group").addClass("has-error has-feedback"),o.closest("div").append($('<span id="'+e+'-error" class="help-block">'+t+"</span>"))}}),O=Marionette.View.extend({template:"#before-process-request-template",templateContext:function(){return{msg:this.options.msg,title:this.options.title}},initialize:function(){_.bindAll(this,"handleSaveSuccess","handleSaveError")},events:{"click #startProcessRequestButton":"start","click #cancelProcessRequestButton":"cancel"},start:function(e){e.preventDefault(),this.model.save({status:this.options.nextStatus},{wait:!0,success:this.handleSaveSuccess,error:this.handleSaveError})},cancel:function(e){e.preventDefault(),window.location.href="/requests/"},handleSaveSuccess:function(e,t){Backbone.history.navigate(t.id+"/workflow/"+this.options.navText,{trigger:!1}),this.options.nextViewFunction&&this.options.nextViewFunction.apply(this.options.rootView,[this.model])},handleSaveError:function(e,t){t.responseJSON.message&&this.showAlert([t.responseJSON.message],"danger")}}),N=Marionette.View.extend({template:"#view-records-template",regions:{body:{el:"#view-records",replaceElement:!0}},initialize:function(){_.bindAll(this,"handleSaveSuccess","handleSaveError")},events:{"click #startTransitButton":"startTransit"},startTransit:function(e){e.preventDefault(),this.model.save({status:"TRANSIT"},{wait:!0,success:this.handleSaveSuccess,error:this.handleSaveError})},handleSaveSuccess:function(e,t){swal({title:"Request Updated!",text:"Records are now in transit.",type:"success"},function(){window.location.href="/requests/"+t.id})},handleSaveError:function(e,t){t.responseJSON.message&&this.showAlert([t.responseJSON.message],"danger")}}),F=Marionette.View.extend({tagName:"li",className:function(){return"list-group-item list-group-item-"+(this.model.get("verified")?"success":"danger")},template:"#verify-records-row-template",templateContext:function(){return{isSystemBoxesView:this.isSystemBoxesView}},initialize:function(e){this.isSystemBoxesView=e.isSystemBoxesView},triggers:{"click .deleteIncomingBox":"delete:incoming:box"}}),P=Marionette.View.extend({template:_.template("No Boxes.")}),U=Marionette.CollectionView.extend({tagName:"ul",className:"list-group boxlist",childView:F,emptyView:P,childViewOptions:function(){return{isSystemBoxesView:this.options.isSystemBoxesView}},onChildviewDeleteIncomingBox:function(e){this.triggerMethod("delete:incoming:box",e.model)}}),Q=Marionette.View.extend({template:"#verify-records-template",events:{"change #incomingBoxBarcode":"addIncomingBox","blur #incomingBoxBarcode":"focusBack"},focusBack:function(){this.$("#incomingBoxBarcode").val(""),this.$("#incomingBoxBarcode").focus()},regions:{incomingBoxesRegion:{el:"#incomingBoxesRegion",replaceElement:!0},systemBoxesRegion:{el:"#systemBoxesRegion",replaceElement:!0}},initialize:function(){_.bindAll(this,"handleSaveSuccess","handleSaveError","updateRequest"),this.systemBoxes=new l,_.each(this.model.get("inventoryItems"),function(e){var t=new d({id:e.boxBarcode});this.systemBoxes.add(t)},this),this.incomingBoxes=new l},addIncomingBox:function(e){var t=this.$("#incomingBoxBarcode").val().toUpperCase().trim();if(this.$("#incomingBoxBarcode").val(""),this.$("#incomingBoxBarcode").focus(),console.log(e,t),t){var o=this.systemBoxes.get(t),i=void 0!==o;!0===i&&(o.set("verified",!0),this.systemBoxes.add(o),this.systemBoxes.trigger("reset"));var s=new d({id:t,verified:i});this.incomingBoxes.add(s),this.updateVerifyProgress()}},updateRequest:function(){this.model.save({status:"VALIDATED"},{wait:!0,success:this.handleSaveSuccess,error:this.handleSaveError})},handleSaveSuccess:function(e,t){swal({title:"Request Updated!",text:"Records are now validated.",type:"success"},function(){window.location.href="/requests/"+t.id})},handleSaveError:function(e,t,o){t.responseJSON.message&&(swal.close(),this.showAlert([t.responseJSON.message],"danger"))},updateVerifyProgress:function(){var e=this.systemBoxes.where({verified:!0}),t=this.systemBoxes.size(),o=this.incomingBoxes.where({verified:!0}),i=this.incomingBoxes.size(),s=parseInt(e.length/t*100),n=this.$("#verifyProgressbar");n.width(s+"%"),n.text(s+"%"),e.length===t&&o.length===i&&t===i&&swal({title:"All Records Verified!",text:"",type:"success",closeOnConfirm:!1},this.updateRequest)},onRender:function(){this.updateVerifyProgress(),this.showChildView("incomingBoxesRegion",new U({collection:this.incomingBoxes,isSystemBoxesView:!1})),this.showChildView("systemBoxesRegion",new U({collection:this.systemBoxes,isSystemBoxesView:!0}))},onChildviewDeleteIncomingBox:function(e){var t=e.id;this.incomingBoxes.remove(e);var o=this.systemBoxes.get(t);void 0!==o&&(o.set("verified",!1),this.systemBoxes.trigger("reset")),this.updateVerifyProgress()},onAttach:function(){this.$("#incomingBoxBarcode").focus()}}),J=Marionette.View.extend({tagName:"li",className:"list-group-item list-group-item-info",template:"#store-records-row-template",templateContext:function(){return{isStoredBoxesView:this.isStoredBoxesView}},initialize:function(e){this.isStoredBoxesView=e.isStoredBoxesView},triggers:{"click .deleteStoredBox":"delete:stored:box"}}),L=Marionette.View.extend({template:_.template("No Boxes. Start scanning boxes & shelves.")}),W=Marionette.CollectionView.extend({tagName:"ul",className:"list-group boxlist",childView:J,emptyView:L,childViewOptions:function(){return{isStoredBoxesView:this.options.isStoredBoxesView}},onChildviewDeleteStoredBox:function(e){this.triggerMethod("delete:stored:box",e.model)}}),z=Marionette.View.extend({template:"#store-records-template",events:{"change #validatedBoxBarcode":"storeBox"},focusBack:function(){this.$("#validatedBoxBarcode").val(""),this.$("#validatedBoxBarcode").focus()},regions:{validatedBoxesRegion:{el:"#validatedBoxesRegion",replaceElement:!0},storedBoxesRegion:{el:"#storedBoxesRegion",replaceElement:!0}},initialize:function(){_.bindAll(this,"handleSaveSuccess","handleSaveError","updateRequest"),this.validatedBoxes=new g,this.storedBoxes=new g,this.resetLists()},resetLists:function(){this.validatedBoxes.reset(),this.storedBoxes.reset();var t,o=this.model.get("storageType").name;_.each(this.model.get("inventoryItems"),function(e){t=new u("BOX"===o?e.box:"FILE"===o?e.file.box:e.document.file.box),this.validatedBoxes.add(t)},this)},storeBox:function(e){var t=this.$("#validatedBoxBarcode").val().trim().toUpperCase();if(this.$("#validatedBoxBarcode").val(""),t){var o=this.validatedBoxes.findWhere({barcode:t}),i=this;void 0!==o?swal({title:"Scan Shelf Barcode",text:"",type:"input",showCancelButton:!0,closeOnConfirm:1!==this.validatedBoxes.size(),inputPlaceholder:"Shelf Barcode"},function(e){return!1!==e&&(""===e?(swal.showInputError("Scan shelf!"),!1):(o.set("shelf",{barcode:e}),o.set("location",e),i.storedBoxes.add(o),i.validatedBoxes.remove(o),void i.updateStoreProgress()))}):swal({title:"Not a valid box!",text:"Barcode is not part of this request.",type:"error"})}},updateStoreProgress:function(){var e=this.validatedBoxes.size(),t=this.storedBoxes.size(),o=parseInt(t/(e+t)*100),i=this.$("#storeProgressbar");i.width(o+"%"),i.text(o+"%"),0===e&&this.updateRequest()},updateRequest:function(){this.storedBoxes.url="/api/boxes/batch",this.storedBoxes.sync("update",this.storedBoxes,{success:this.handleSaveSuccess,error:this.handleSaveError})},getLocation:function(e){return this.storedBoxes.findWhere({barcode:e}).get("location")},handleSaveSuccess:function(){var t=this.model.get("storageType").name;_.each(this.model.get("inventoryItems"),function(e){e.status="STORED","BOX"===t?e.box.location=this.getLocation(e.box.barcode):"FILE"===t?e.file.location=this.getLocation(e.file.box.barcode):e.document.location=this.getLocation(e.document.file.box.barcode)},this),this.model.save({status:"STORED"},{wait:!0,success:this.handleSaveSuccess2,error:this.handleSaveError2})},handleSaveSuccess2:function(e,t){swal({title:"Request Updated!",text:"Records are now stored.",type:"success"},function(){window.location.href="/requests/"+t.id})},handleSaveError2:function(e,t){t.responseJSON.message&&(swal.close(),n.showAlert([t.responseJSON.message],"danger"))},handleSaveError:function(e){swal.close(),this.resetLists(),this.updateStoreProgress(),e.responseJSON&&e.responseJSON.message?n.showAlert("Error saving boxes",e.responseJSON.message,"danger"):n.showAlert("Error saving boxes",e,"danger")},onChildviewDeleteStoredBox:function(e){this.storedBoxes.remove(e),this.validatedBoxes.add(e),this.updateStoreProgress()},onRender:function(){this.updateStoreProgress(),this.showChildView("validatedBoxesRegion",new W({collection:this.validatedBoxes,isStoredBoxesView:!1})),this.showChildView("storedBoxesRegion",new W({collection:this.storedBoxes,isStoredBoxesView:!0}))},onAttach:function(){this.$("#validatedBoxBarcode").focus()}}),X=Marionette.View.extend({template:"#close-request-template",events:{"click #cancelButton":"cancel"},cancel:function(e){e.preventDefault(),window.location.href="/requests/"}}),G=Marionette.View.extend({template:_.template('<div id="main"></div>'),regions:{main:"#main"},showAssignUserView:function(e){this.showChildView("main",new R({model:e,rootView:this}))},showBeforeProcessRequestView:function(e,t,o,i,s,n){this.showChildView("main",new O({model:e,rootView:this,title:t,msg:o,nextStatus:i,nextViewFunction:s,navText:n}))},showAddRecordsView:function(e){this.showChildView("main",new M({model:e,rootView:this}))},showViewRecordsView:function(e){this.showChildView("main",new N({model:e,rootView:this}))},showVerifyRecordsView:function(e){this.showChildView("main",new Q({model:e,rootView:this}))},showStoreRecordsView:function(e){this.showChildView("main",new z({model:e,rootView:this}))},showCloseRequestView:function(e){this.showChildView("main",new X({model:e,rootView:this}))}}),K=Marionette.Object.extend({start:function(e,t){var o=new a({id:e});this.listenToOnce(o,"sync",this.workflow),o.fetch()},workflow:function(e){var t=this.getOption("rootView"),o=e.get("type"),i=e.get("status");"PICKUP"===o&&("OPEN"===i?t.showAssignUserView(e):"ASSIGNED"===i?t.showBeforeProcessRequestView(e,"Add Records","Proceed with adding records to this request?","INPROGRESS",t.showAddRecordsView,"addRecords"):"INPROGRESS"===i?t.showAddRecordsView(e):"PACKED"===i?t.showViewRecordsView(e):"TRANSIT"===i?t.showBeforeProcessRequestView(e,"Verify Records","Proceed with verifying the incoming records for this request?","INCOMING",t.showVerifyRecordsView,"verifyRecords"):"INCOMING"===i?t.showVerifyRecordsView(e):"VALIDATED"===i?t.showStoreRecordsView(e):"STORED"===i?t.showBeforeProcessRequestView(e,"Close Request","Proceed with closing this request?","CLOSED",t.showCloseRequestView,""):"CLOSED"===i&&t.showCloseRequestView(e))}}),Y=Marionette.AppRouter.extend({initialize:function(e){this.controller=new K(e)},appRoutes:{":requestId/workflow":"start",":requestId/workflow/*splat":"start"}});(new(Marionette.Application.extend({region:"#app",onStart:function(){var e=new G;new Y({rootView:e});this.showView(e),Backbone.history.start({pushState:!0,root:"/requests"})}}))).start()}();