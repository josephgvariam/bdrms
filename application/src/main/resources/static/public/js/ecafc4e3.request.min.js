var bdRequest=function(){var o=Backbone.Model.extend({defaults:{ref1:"",ref2:"",ref3:"",ref4:"",ref5:"",status:null,type:null}}),d=new(Backbone.Collection.extend({model:o})),c=[],e=Marionette.View.extend({tagName:"tr",template:"#record-row-template"}),t=Marionette.View.extend({template:_.template("No Records. Start adding records.")}),a=Marionette.CollectionView.extend({tagName:"tbody",childView:e,emptyView:t}),r=Marionette.View.extend({template:"#records-template",regions:{body:{el:"tbody",replaceElement:!0}},initialize:function(){},events:{"click #addRecordsButton":"showRecordsModal","click #okModalButton":"addRecords"},addRecords:function(e){var t=$("#recordsDataTable").DataTable().rows([".selected"]).data().toArray(),r=[];d.reset(),_.each(t,function(e,t){var a=new o(e);d.add(a),r.push(e.id)},this),$("#inventoryItemsField").val(r.toString()),$("#recordsModal").modal("hide")},showRecordsModal:function(e){e.preventDefault();var t="",a=window.location.pathname;if(-1!==a.indexOf("requests/")&&-1!==a.indexOf("edit-form")){var r=a.indexOf("requests/")+9,o=a.indexOf("/",r+1);t=a.substring(r,o)}var d=$("#storagetypesselect2").select2("data")[0],s=null;if("TRANSFER"===bdRequest.requestType){var n=$("#fromfacilityselect2").select2("data")[0];if(!n)return void swal("Error!","Please select a From facility!","error");if(!(s=n.id))return void swal("Error!","Please select a From facility!","error")}if(d){var l=d.text;$("#recordsModal").modal({show:!0,backdrop:"static",keyboard:!1});var i="/api/inventoryitems?storageType="+l+"&requestType="+bdRequest.requestType+"&requestId="+t+"&fromFacilityId=";s&&(i=i+"&fromFacilityId="+s);$("#recordsDataTable").DataTable({retrieve:!0,searching:!0,ordering:!1,rowId:"id",ajax:{url:i,dataSrc:""},columns:[{data:"id"},{data:"id"},{data:l.toLowerCase()+"Barcode"},{data:"ref1"},{data:"ref2"},{data:"ref3"},{data:"ref4"},{data:"ref5"}],columnDefs:[{targets:0,checkboxes:{selectRow:!0}}],select:{style:"multi"},createdRow:function(e,t,a){var r="";r="DOCUMENT"===t.type?t.documentBarcode:"FILE"===t.type?t.fileBarcode:t.boxBarcode,$(e).attr("data-barcode",r)}});$("#recordsModal").on("shown.bs.modal",function(){var t=$("#recordsDataTable").DataTable();t.columns.adjust(),_.each(c,function(e){t.row("#"+e).select()})})}else swal("Error!","Please select a Storage Type!","error")},onRender:function(){this.showChildView("body",new a({collection:d}))}});return(new(Marionette.Application.extend({region:"#app",onStart:function(){var e=new r;this.showView(e)}}))).start(),{InventoryItem:o,inventoryItems:d,selectedInventoryItems:c,requestType:""}}();$(function(){$("#storagetypesselect2").on("select2:select",function(e){$.fn.DataTable.isDataTable("#recordsDataTable")&&($("#recordsDataTable").DataTable().destroy(),bdRequest.inventoryItems.reset(),$("#inventoryItemsField").val(""))}),$("#saveRequestButton").click(function(e){$("#inventoryItemsField").val()||(swal("No records","Please select some records.","error"),e.preventDefault())})});